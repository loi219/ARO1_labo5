\documentclass[a4paper]{article} %format de la feuille + type de document https://en.wikibooks.org/wiki/LaTeX/Document_Structure#Document_classes
%packages nécessaire pour nos besoins
\usepackage[utf8]{inputenc}
\usepackage[T1]{fontenc}
\usepackage[english,french]{babel}
\usepackage{amsmath}
\usepackage{amssymb,amsfonts,textcomp}
\usepackage{color}
\usepackage{array}
\usepackage{supertabular}
\usepackage{hhline}
\usepackage{hyperref}
\usepackage{capt-of}
\usepackage[pdftex]{graphicx}
\usepackage{sectsty}
\usepackage{tcolorbox}
\usepackage{textcomp}
\usepackage{courier}
\usepackage[font={small,it}]{caption}
\usepackage{float}
\usepackage{graphicx}
\usepackage{subcaption}
\usepackage{caption}


%Définition des couleurs
\definecolor{havelockBlue}{rgb}{0.004, 0.42, 0.73}
\definecolor{Monokaimagenta}{rgb}{0.86,0.08,0.24}

%utilisation de la couleur définie avant
%toutes les sections auront cette couleur
\sectionfont{\color{havelockBlue}}
\subsectionfont{\color{havelockBlue}}
%début du document
\begin{document}

%début d'un titre
\begin{titlepage}
            %centre les éléments
	\centering
	
	{\scshape\LARGE \color{Monokaimagenta} Laboratoire \\ Universal Asynchronous Receiver Transmitter \par}
	
	%espace vertical de 1 mms
	\vspace{1cm}
	
	{\Large\itshape Johanna Melly \& Sven Rouvinez\par}
	
	%http://www.personal.ceu.hu/tex/spacebox.htm
	\vfill
	Professeur\par
	%met le texte en gras 
	\textbf{Carlos Andrés Pena} \par% ajoute une ligne 
	\vspace{1cm}
	Assistant\par
	\textbf{Gaëtan Matthey}
	
	\vfill

            %affiche la date actuelle
	{\large \today\par}
	
%fin de la page de titre
\end{titlepage}

%démarre un chapitre, les nombres se mettent automatiquement et seront incrémenté quand un autre \section est rencontré
%voir https://en.wikibooks.org/wiki/LaTeX/Document_Structure#Sectioning_commands
\section{Description générale}
On appelle « trame » une suite de bits envoyés en série. Cette trame comprend dans l’ordre :
\begin{itemize}
\item Le « start-bit » toujours égal à 0.
\item Les bits de donnée (sur n bits) à transmettre.
\item Le bit de parité facultatif (non demandé dans ce labo).
\item Le bit de stop égal à 1.
\end{itemize}
De plus, l’état de repos de la ligne est fixé à 1.
\\ 
\begin{figure}[H]
    \centering
    \includegraphics[width=.8\textwidth]{src/uart_1.jpg}
    \captionof{figure}{trame}
    \label{fig:trame}
\end{figure}


%saut à la ligne


%début d'un encadré avec la couleur définie plus haut
\begin{tcolorbox}[colframe=Monokaimagenta,colback=white]
Nous réalisons la partie récepteur. Le circuit se compose d'un shift register, de deux compteurs, un registre de sortie et un machine à états pour le contrôle.\\
Le début de la communication démarre lorsque que le contrôle reçoit un $0$.

\begin{itemize}
    \item    Après un reset, le registre de sortie contient la valeur $0$
    \item    Détection du front descendant sur l'entrée série provoqué par le \textbf{start bit} de l'émetteur
        \begin{itemize}
            \item    \begin{figure}[H]
                        \centering
                        \includegraphics[width=.8\textwidth]{src/chrono_emetteur.jpg}
                        \captionof{figure}{Chronogramme émetteur}
                     \label{fig:trame}
                \end{figure}
        \end{itemize}
    \item    Chargement des bits tous les 4 cycles d'horloge après le front descendant du \textbf{start bit}
    \item    Quand la tranmission est finie, la trame est chargée dans le registre de sortie
    
\end{itemize}   
%fin de l'encadré
\end{tcolorbox}

\section{Architecture}\

\begin{tcolorbox}[colframe=Monokaimagenta,colback=white]
\paragraph{Architecture - Max 1/2 page}
Dessinez le schéma bloc complet de votre circuit. Ce circuit contient entre autre : shift-register, compteurs et machine d’état, avec les bus de données et les signaux de contrôle. Vous pouvez faire ce schéma bloc à la main (très proprement), ou en utilisant Logisim (mais avec le nom des signaux), ou avec un outil de dessin de votre choix.

Remplacez le texte ci-dessus par vos réponses (à l’intérieur du cadre rouge)\\


\end{tcolorbox}


\section {Réalisation}
\subsection{Le bloc shift-register}
Ce bloc sur 8 bits a 4 modes de fonctionnement. Vous devez le refaire entièrement avec des bascules et des multiplexeurs.
\begin{tcolorbox}[colframe=Monokaimagenta,colback=white]
\paragraph{Conception et tests - Max 1 page}
Insérez une capture d’écran pour présenter votre bloc shift-register. Expliquez brièvement son fonctionnement.
Indiquez comment vous avez testé les 4 modes de fonctionnement afin de le valider.
Remplacez le texte ci-dessus par vos réponses (à l’intérieur du cadre rouge)
\\
\end{tcolorbox}
\subsection{Le bloc compteur 0-3}
Le premier compteur demandé compte de 0 à 3. Ce compteur comprend une entrée de remise à 0 synchrone et une sortie indiquant que le compteur a atteint sa valeur maximum.
\begin{tcolorbox}[colframe=Monokaimagenta,colback=white]
\paragraph{Conception et tests - Max 1 page }
\begin{figure}[H]
\centering
    \includegraphics[width=.8\textwidth]{src/COUNT_4BITS.png}
    \captionof{figure}{Compteur 0\-3}
    \label{fig:count4bits}
\end{figure}
Insérez une capture d’écran pour présenter votre bloc compteur 0-3. Expliquez sa réalisation et son fonctionnement.
Indiquez comment vous avez testé les différents modes de fonctionnement afin de le valider. Vous pouvez ajouter un chronogramme.
Remplacez le texte ci-dessus par vos réponses (à l’intérieur du cadre rouge)


Ce bloc est composé d'un bloc de base (voir \ref{fig:countBase}) qui s'occupe uniqument de changer d'étât une bascule D, ce qui aura comme effet de compter lorsque qu'il est connecté avec d'autres de ces blocs.\\
\paragraph{Définition des entrées}
\begin{itemize}

    \item     \textbf{A} active le compteur
    \item     \textbf{CLK} permet de connecter l'horloge du circuit "maître"
    \item     \textbf{CLR} permet une remise à zéro du compteur

\end{itemize}

\paragraph{Définition des sorties}
\begin{itemize}

    \item     \textbf{MAX} s'active lorsque que le compteur à atteint sa valeur maximum, c'est-à-dire 3.
    \item     \textbf{D} affiche l'état du compteur
\end{itemize}


\end{tcolorbox}
\subsection{Le bloc compteur 0-7}
Le deuxième compteur demandé compte de 0 à 7. Ce compteur comprend une entrée de remise à 0 synchrone, une entrée enable pour l’activer et une sortie indiquant que le compteur a atteint sa valeur maximum.
\begin{tcolorbox}[colframe=Monokaimagenta,colback=white]
\paragraph{Conception et tests - Max 1 page}
Insérez une capture d’écran pour présenter votre bloc compteur 0-7. Expliquez sa réalisation et son fonctionnement. Inutile de reprendre les explications du paragraphe précédent 3.2. Expliquez simplement ce que vous avez dû changer ou rajouter pour passer du compteur 0-3 au compteur 0-7.
Indiquez comment vous avez testé les différents modes de fonctionnement afin de le valider. Vous pouvez ajouter un chronogramme.
Remplacez le texte ci-dessus par vos réponses (à l’intérieur du cadre rouge)
\\
\end{tcolorbox}
\subsection{La machine d’état}
Cette machine d’état de type 1 parmi M contrôle les deux compteurs et le shift register. 
\begin{tcolorbox}[colframe=Monokaimagenta,colback=white]
\paragraph{Conception Max 3 pages}

Précisez les entrées et sorties de votre machine d’état

La machine d'état est composée de deux bascules, et prend en entrée:
\begin{itemize}

    \item     \textbf{LAST_BIT} reçoit le bit envoyé par l'émetteur
    \item     \textbf{COUNT_8BITS_MAX} compte de 0 à 7
    \item     \textbf{COUNT_4BITS_MAX} compte de 0 à 3
    \item     \textbf{CLR} permet une remise à zéro du compteur
    \item     \textbf{CLK} pin connecté à l'horloge principale
\end{itemize}
En sortie:
\begin{itemize}
    \item     \textbf{D} Permet de savoir où commence et se termnine la séquence de bits envoyée.
\end{itemize}
Cette machine d'état prend en entrée le compteur 4 bits, le compteur 8 bits et le bit envoyé par l'émetteur. Les bascules bistables sont de type S-R car il fallait qu'elle ne change pas d'état après être passée à 1 au flanc montant. Cette machine d'état va renvoyer un 1 si un '0' à été transmis comme signal de départ et si 8 coups d'horloges n'ont pas encore été atteints.
La première bascule prend en entrée l'inverse du bit envoyé par l'émetteur (de façon à ce que l'horloge passe à 1 lorsuqe le bit envoyé est un 0). Ainsi, à chaque coup d'horloge, l'horloge de la première bascule va passer à 1, et si l'entrée de S de la bascule est à 1 (et donc le bit envoyé par l'émetteur à 0), l'état de la bascule va passer à 1 et y rester. Ainsi, on sait que le bit qui signale le départ à été envoyé.
La deuxième bascule prend en entrée le compteur 8 bits. Ainsi, à chaque coup d'horloge, la bascule va "contrôler" que l'on n'ait pas atteint la fin du mot. Si l'entrée est à 1 lorsque le compteur 8 bit annonce la fin du mot, la bascule change d'état et y reste.
Au bout du circuit, une porte XOR permet de savoir si les deux bascules ne sont pas au même état.
Ainsi, au départ, la sortie est à 0. Dès qu'un 0 est transmis par l'émetteur, la première bascule passe à 1, et la sortie sera à 1 également. Puis, dès qu'on atteint les 8 coups de clock, la deuxième bascule passe à 1 aussi, et la sortie passe donc définitivement à 0.
Enfin, un MUX tout à la fin enverra en sortie la constante 0 tant que le COUNT_4BIT_MAX est à 0, et enverra en sortie le résultat du XOX si COUNT_4BITS est à 1. Ainsi, on prend en compte l'état de la machine d'état chaque 4 coups d'horloge (puisque les bits émis par l'émetteurs son récupérés chaque 4 coups d'horloge).

Insérez un graphe des états et une table des états. Donnez des explications sur le fonctionnement de votre machine. Quel est son Type ?
Donnez les équations des états futurs et insérez une capture d’écran de la réalisation de votre machine.
Remplacez le texte ci-dessus par vos réponses (à l’intérieur du cadre rouge)
\\
\end{tcolorbox}
\section {Intégration et simulation}
\subsection{Intégration}
Suivant votre partie à concevoir, vous devez réaliser l’UART en interconnectant les différents blocs. 
\begin{tcolorbox}[colframe=Monokaimagenta,colback=white]
\paragraph{Réalisation et simulation Logisim - Max 1 page}
Insérez une capture d’écran de l’UART complet sous Logisim
Expliquez le fonctionnement global de l’UART
L'UART est composé d'un compteur 4 bits (COUNT_4BITS_1), d'un compteur 8 bits (COUNT_8BITS_1), d'une machine d'état (STAMAC_1), d'un shift reister 8 bits (SHREGI_8BITS_1) ainsi qu'un register de sortie 8 bits (REGI_8BITS_1).
Les différentes entrées de l'UART sont:
\begin{itemize}
    \item     \textbf{A} le bit envoyé par l'émetteur
    \item     \textbf{CLR} permet une remise à zéro du compteur
    \item     \textbf{sysclk} l'horloge principale, reliée à tous les circuits
\end{itemize}
En sortie:
\begin{itemize}
    \item     \textbf{Output_bus_1} Affiche la sortie du shift register
    \item     \textbf{D} Affiche la sortie du register, donc la séquence de 8 bits transmise, après 8 X 4 coups d'horloge.
\end{itemize}
Le bit transmis A va tout d'abord être converti en un 8 bits sous cette forme: AAAAAAAA. Le but sera l'entrée D du shift register.
La machine d'état va permettre d'activer ou non le shift register. Lorsqu'un premier 0 est transmis par l'émetteur (ce qui marque le début de la séquence à recevoir), la machine d'état va activer le shift register en lui passant le bit de sortie dans son entrée s. La sortie de la machine d'état va être prise en compte chaque 4 coups d'horloge, le reste du temps elle sera à 0. Ainsi, le shift register va être activé uniquement chaque 4 coups d'horloge (comme requis), et ce 8 fois (le temps de recevoir le mot en entier).
Le compteur 4 bits prend nu 1 en entrée car il doit compter continuellement. Le compteur 8 bits, lui doit commencer à compter seulemement lorsqu'on doit recevoir les bits de l'émetteur, et doit considerer 4 coups d'horloge comme un seul. Il prend donc en entrée la sortie de la machine d'état, ce qui va permettre d'activer le compteur au bon moment, et seulement chaque 4 coups d'horloge.
Le register de sortie a pour rôle de load les 8 bits dans une sortie lorsqu'ils ont été transmis. Il prend donc en entrée A la sortie du chift register, qui contiendra les bits reçus. En entrée S, il prend la sortie du compteur 8 bits, ainsi c'est seulement à la fin de la réception des 8 bits que les bits vont être loadés. Le reste du temps, le register sera sur hold.
Ainsi, on a bien une réception de 8 bits loadés dans une sortie après 8 X 4 coups d'horloge après la signal donné par un bit à 0 transmis au début.
\\
\end{tcolorbox}
 \subsection{Simulation sous Logisim}
L’UART réalisé est ensuite testé en simulation sous Logisim.
\begin{tcolorbox}[colframe=Monokaimagenta,colback=white]
\paragraph{Réalisation et simulation Logisim - Max 2 pages}
Indiquez comment vous simulez votre UART sous Logisim (seul ou avec le générateur fourni), ET avec un UART d’un autre groupe (indiquez quel groupe)
Insérez un ou plusieurs chronogrammes, annotez-le(s) et expliquez pourquoi le fonctionnement est correct et conforme aux spécifications.
Remplacez le texte ci-dessus par vos réponses (à l’intérieur du cadre rouge)
\\
\end{tcolorbox}
 \subsection{Synthèse et test de fonctionnement réel}
Synthèse et configuration du matériel, test de fonctionnement.
L’UART finalement synthétisé et chargé dans une carte, une carte émetteur sera reliée à une carte récepteur afin de tester une transmission de données. 
\begin{tcolorbox}[colframe=Monokaimagenta,colback=white]
\paragraph{Essais avec une carte - Max 1 page}
Pour l'essai avec la carte, nous avons pris une fréquence à 32Hz, et nous avons downloadé l'UART sur la carte. Nous avons précisé ces données:
\begin{itemize}
    \item     \textbf{A} les 8 bits transmis par l'émetteur
    \item     \textbf{CLR} la remise à zéro du compteur
    \item     \textbf{CLK} l'horloge
\end{itemize}

Nous avons rencontré passablement de difficultés lors de cette étape. Tout d'abord, nous ne pouvions pas charger notre UART sur la carte, car, à la base, les horloges étaient reliées au compteur 4 bits, de sorte à compter un coup d'horloge chaque 4 coups. Malheuresement, nous avons constaté que, de cette manière, les bascules n'étaient pas synchronisées. Nous avons donc dû modifier nos circuits en conséquence.
Un autre poblème que nous avons rencontré, est qu'il n'y avait pas des CLEAR partout, donc lorsque l'on choisissait de "reset" la carte, tout n'était pas remis à 0.
Au final le résultat sur la carte n'était tout de même pas concluant, car trois 0 s'affichent à la fin. Nous n'avons pas trouvé la source de ce problème, même s'il vient probablement d'un compteur. Cependant, les autres bits transmis sont corrects. Sur logisim, l'UART fonctionne correctement.

Indiquez comment vous faites le test (et avec un groupe différent de la simulation). Quelles données choisissez-vous pour faire les essais ?Vous devez faire valider votre circuit en fonctionnement au quiprofesseur ou à l’assistant
Commentez brièvement votre expérience dans cette étape en mentionnant, par exemple, des éventuelles difficultés à faire fonctionner le circuit ou à configurer la carte, etc.
Remplacez le texte ci-dessus par vos réponses (à l’intérieur du cadre rouge)
\\
\end{tcolorbox}
\section {Conclusion}
\begin{tcolorbox}[colframe=Monokaimagenta,colback=white]
\paragraph{Conclusion - Max 1/2 page}
Ce laboratoire était assez complet et regroupait un peu tout ce que nous avions vu jusqu'à maintenant. Il nous a demandé d'investir un temps assez conséquent, notamment parce que nous avions fait plusieurs erreurs dans les circuits, que nous avons parfois mis du temps à trouver.
La plus grosse difficulté a été le test sur carte. Lorsque que nous l'avons fait la permière fois en classe, des erreurs dans les circuits nous ont empêché de le réaliser correctement, et nous avons dû effectuer de nombreuses modifications afin de pouvoir passer l'UART sur la carte. Par la suite, nous avons pu le mettre sur carte pour tester, mais le résultat était peu concluant. Comme cela semblait fonctionner sur logisim, ce résultat était assez frustrant.
En conclusion, la façon dont sont fait nos circuits n'est pas vraiment optimale, et le test sur carte est peu concluant, mais l'ensemble fonctionne et nous avons pu apprendre des erreurs que nous avons commises, et mieux comprendre le fonctionnement des machines d'état. Ce laboratoire était donc enrichissant.

Cette section est libre pour que vous fassiez une analyse critique de votre laboratoire
Commentez et analysez 
les résultats, 
les difficultés et les succès
Rédigez quelques conclusions personnelles
Donnez vos impressions et analysez votre expérience dans ce laboratoire
Discutez de ce que vous avez appris (ou pas)
Analysez votre travail, votre implication
Evitez les banalités et les lieux communs
ETCAETERA…
\\
\end{tcolorbox}

\section{Annexe}


\begin{figure}[H]
\centering
    \includegraphics[width=.8\textwidth]{src/COUNT_BASE.png}
    \captionof{figure}{Circuit de base des compteurs}
    \label{fig:countBase}
    \end{figure}


\end{document}